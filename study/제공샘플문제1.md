[고객상황]
K 소프트웨어는 전 세계 판매를 목적으로 Cloud 환경에 게임 판매 사이트를 구축하려 한다. 
사용자 성향 및 SN분석을 통해 게임을 추천하고, 이를 통해 구매를 유도할 계획이다.
사용자는 사이트를 통해 게임을 다운로드하여 구입, 관리할 수 있으며,
채팅, 방송 및 다양한 커뮤니티 기능을 통해서 다른 사용자와 소통할 수 있다.
사이트의 다양한 기능은 POC 진행 후 고객 Feedback에 따라 확대를 진행하는 방식으로 사업 영역을 넓혀가려고 한다.

[업무요건]
- 전 세계 대상 게임 판매를 목적으로 시스템을 구축하려 한다
- 사용자 증감에 따라서 시스템 확장이 유연해야 한다
- 업무 특성에 맞는 최적의 개발 언어와 DB를 선택하여 구축한다(커뮤니티나 채팅은 빠른 응답, 결제와 분석은 안정성)
- 자연재해나 시스템의 물리적인 결함 상황에서도 시스템은 운영이 되어야 한다
- 프로모션은 수시로 진행되며, 운영 중에서도 적용이 쉽게 되면서, 다른 서비스에 영향이 없어야 한다.
- 프로모션이 진행되면 사용자 수가 평소보다 급격히 증가할 것으로 예상된다
- 가입과 인증을 쉽게 하기 위해 각 국가의 소셜 로그인 기능을 지속적으로 추가하여, 사용자 가입을 유도한다.
- 사용자가 게임을 직접 검색할 수도 있고, 시스템이 사용자의 개인 성향에 따라서 맞춤형 게임을 추천 할 수 있어야 한다
- 추천은 게임의 평점, 최근 플레이한 게임, 커뮤니티 및 각종 SNS 사이트의 내용 등을 고려한다
- 다양한 결제 방법을 선택할 수 있고, 각 국가의 대표적인 결제 수단이 반영되어야 한다
- 사용자는 다양한 SNS를 통하여 본인의 게임 내용을 쉽게 공유할 수 있어야 한다
- 특정 지역에서는 계약 및 법률 규정에 따라서 판매 및 이용이 불가능하도록 해야 한다
- 모든 구매를 포함한 사용자의 활동 정보는 분석을 위하여 사용되고, 다시 사용자에게 feedback되어야 한다

[업무시나리오1]
- 신규 출기 게임 예약
1. 신규 게임 출시가 확정되면 담당자는 게임을 등록한다
2. 신규 게임이 출시되면 해당 게임 유형 선호도가 높은 사용자에게 추천 시스템을 통해 이메일을 자동 발송한다
3. 사용자는 메일 예약 링크 또는 사이트 검색을 통해 예약 주문을 진행한다
4. 신규 게임의 서비스 대상 국가와 사용자의 거주 국가가 일치하지 않는 경우에는 예약을 할 수 없다
5. 사용자는 결제 방식을 선택하고 결제를 진행한다
6. 결제 금액은 담당자가 등록한 할인 금액이 적용된다
7. 결제는 해당국가에서 지원하는 신용카드와 간편 결제 서비스를 통해서 이루어진다
8. 결제 시 포인트를 사용할 수 있고, 사용한 포인트를 제외한 금액이 신용카드나 간편결제 서비스에 청구된다
9. 결제를 완료하면 예약이 완료된다
10. 결제가 완료하면 사용자에게 포인트가 적립되고 메일이 발송된다
11. 구매목록에 신규 게임이 나타나고 "환불요청" 버튼이 활성화된다
12. "환불요청" 버튼을 누르면 예약과 결제가 동시에 취소된다
13. 취소가 되면 사용자의 구매 목록에서 사라진다
14. 환불을 진행하면 적립된 포인트도 차감이 된다
15. 출시일이 되면 사용자는 다운로드가 가능해진다
16. 출시일이 되면 예약 할인이 종료되고 정상가로 구매가 가능하다

[업무시나리오2]
- 선물하기
1. 사용자는 선물하기를 통하여 게임이 다른 사용자에게 선물할 수 있다
2. 기존에 구매한 제품은 선물이 불가하다
3. 게임 상점 페이지에서 "선물로 구매"를 선택한다
4. 선물은 친구 목록에 추가된 사용자에게만 가능하다. 친구목록은 사전에 상대방의 승인을 통해서 등록한다
5. 선물할 게임을 가지고 있는 친구는 친구 목록에 나타나지 않는다
6. 선물할 친구가 포함되어 있지 않다면, 친구 추가 메뉴에서 추가한다. 시스템은 추가된 친구에게 메일을 발송한다
7. 선물하기는 바로 보내기 또는 예약을 통하여 특정 날짜에 자동 전달이 될 수 있다. 이때 메시지를 작성할 수 있다.
8. 결제는 사용자의 국각에서 지원하는 결제 방식(신용카드/간편결제시스템)을 선택하여 결제한다
9. 결제는 외부업체를 통해서 처리한다
10. 결제가 완료되면 친구에게 알림과 이메일이 발송된다
11. 선물을 받은 사람이 "선물 수락"을 하면 게임을 다운로드 받게 된다
12. 선물을 받은 사람이 "선물 거절"을 하면 보낸 사람에게 바로 환불 처리가 된다
13. 친구가 30일 동안 수락하지 않으면 자동 환불 처리가 된다
14. 선물한 내용은 리포팅 시스템에서 조회가 가능하다

[문제1]
업무시나리오1 에서 예약 결제(5~6)와 환불 처리(12~14)에 대해, 아래 오건을 고러하여 필요한 API 기능을 정의하고, 
실패시 필요한 보상 트랜잭션에 대해서 정리하시오.
- 예약 결제와 환불 처리에 대해서 각각 작성
- 서비스는 1번 문제에서 도출한 서비스를 기반으로 작성(필요 시 추가 가능)
- 보상 트랜잭션의 호출이 최대한 적게 발생할 수 있도록 호출순서 정의
- 트랜잭션 종류에 보상가능/피봇/재시도가능 트랜잭션 표기
- 순서, 동기/비동기, API 서비스, API기능명, 필요보상 트랜잭션 서비스, 필요보상 트랜잭션 기능명, 트랜잭션 종류(보상가능/피봇/재시도가능)를 표로 표기

**업무시나리오1의 예약 결제와 환불 처리에 대한 API 기능과 실패 시 필요한 보상 트랜잭션을 아래와 같이 정의하였습니다. 각 트랜잭션의 순서, 동기/비동기, API 서비스, API 기능명, 필요 보상 트랜잭션 서비스, 필요 보상 트랜잭션 기능명 및 트랜잭션 종류를 포함하여 작성했습니다.**

### 예약 결제 (5~11)

| 순서 | 동기/비동기 | API 서비스    | API 기능명             | 필요보상 트랜잭션 서비스 | 필요보상 트랜잭션 기능명 | 트랜잭션 종류        |
| ---- | ----------- | ------------- | ---------------------- | ------------------------ | ------------------------ | -------------------- |
| 1    | 동기        | 예약 서비스   | `createReservation`    | `cancelReservation`      | `cancelReservation`      | 보상가능 트랜잭션    |
| 2    | 동기        | 결제 서비스   | `initiatePayment`      | `refundPayment`          | `refundPayment`          | 피봇 트랜잭션        |
| 3    | 동기        | 결제 서비스   | `processPayment`       | `restorePayment`         | `restorePayment`         | 피봇 트랜잭션        |
| 4    | 비동기      | 포인트 서비스 | `applyPoints`          | `restorePoints`          | `restorePoints`          | 재시도 가능 트랜잭션 |
| 5    | 비동기      | 메일 서비스   | `sendReservationEmail` | `retryEmailSending`      | `retryEmailSending`      | 재시도 가능 트랜잭션 |

### 환불 처리 (12~14)

| 순서 | 동기/비동기 | API 서비스    | API 기능명      | 필요보상 트랜잭션 서비스 | 필요보상 트랜잭션 기능명 | 트랜잭션 종류        |
| ---- | ----------- | ------------- | --------------- | ------------------------ | ------------------------ | -------------------- |
| 1    | 동기        | 환불 서비스   | `processRefund` | `restoreReservation`     | `restoreReservation`     | 보상가능 트랜잭션    |
| 2    | 동기        | 결제 서비스   | `refundPayment` | `reverseRefund`          | `reverseRefund`          | 피봇 트랜잭션        |
| 3    | 비동기      | 포인트 서비스 | `deductPoints`  | `restorePoints`          | `restorePoints`          | 재시도 가능 트랜잭션 |

### 설명

1. **예약 결제 (5~11)**
   - **`createReservation`** (동기): 사용자의 예약을 생성합니다. 실패 시 `cancelReservation`을 호출하여 예약을 취소합니다. (보상 가능)
   - **`initiatePayment`** (동기): 결제 요청을 시작합니다. 실패 시 `refundPayment`를 호출하여 결제 취소를 시도합니다. (피봇)
   - **`processPayment`** (동기): 결제를 실제로 처리합니다. 실패 시 `restorePayment`를 호출하여 결제 상태를 복구합니다. (피봇)
   - **`applyPoints`** (비동기): 포인트를 사용하여 결제 금액을 차감합니다. 실패 시 `restorePoints`를 호출하여 포인트를 복구합니다. (재시도 가능)
   - **`sendReservationEmail`** (비동기): 예약 완료 이메일을 발송합니다. 이메일 발송 실패 시 `retryEmailSending`을 호출하여 재시도합니다. (재시도 가능)
2. **환불 처리 (12~14)**
   - **`processRefund`** (동기): 환불 요청을 처리합니다. 실패 시 `restoreReservation`을 호출하여 예약 상태를 복구합니다. (보상 가능)
   - **`refundPayment`** (동기): 결제 환불을 처리합니다. 실패 시 `reverseRefund`를 호출하여 결제 상태를 복구합니다. (피봇)
   - **`deductPoints`** (비동기): 포인트를 차감합니다. 실패 시 `restorePoints`를 호출하여 포인트를 복구합니다. (재시도 가능)

이 표는 각 API의 실패와 성공을 관리하기 위해 필요한 보상 트랜잭션을 명확히 구분하며, 시스템의 안정성을 높이는 데 도움이 됩니다.